<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>Note Schema Editor - Improved</title>
  <style>
    body {
      font-family: Arial, sans-serif;
      background: #f4f6f9;
      margin: 0;
      padding: 20px;
      color: #333;
    }
    h1, h2, h3 {
      margin-bottom: 10px;
    }
    .card {
      background: #fff;
      border-radius: 10px;
      padding: 20px;
      margin-bottom: 20px;
      box-shadow: 0 4px 8px rgba(0,0,0,0.1);
    }
    button {
      background: #007BFF;
      border: none;
      color: white;
      padding: 8px 14px;
      border-radius: 6px;
      margin: 5px 0;
      cursor: pointer;
    }
    button:hover {
      background: #0056b3;
    }
    .images-preview {
      display: flex;
      gap: 10px;
      margin-top: 10px;
      flex-wrap: wrap;
    }
    .images-preview img {
      width: 80px;
      height: 80px;
      border-radius: 6px;
      object-fit: cover;
      border: 1px solid #ccc;
    }
    /* Modal styles */
    .modal {
      display: none;
      position: fixed;
      top: 0; left: 0; right: 0; bottom: 0;
      background: rgba(0,0,0,0.6);
      z-index: 999;
      align-items: center;
      justify-content: center;
    }
    .modal-content {
      background: #fff;
      padding: 20px;
      border-radius: 10px;
      width: 500px;
      max-width: 90%;
      box-shadow: 0 5px 15px rgba(0,0,0,0.3);
      position: relative;
    }
    .close {
      position: absolute;
      right: 15px;
      top: 10px;
      font-size: 22px;
      cursor: pointer;
      color: #666;
    }
    .json-output {
      background: #222;
      color: #0f0;
      padding: 15px;
      border-radius: 10px;
      font-family: monospace;
      white-space: pre-wrap;
      max-height: 400px;
      overflow: auto;
    }
  </style>
</head>
<body>
  <h1>üìò Note Schema Editor</h1>
  <div class="card">
    <label>Heading: <input type="text" id="heading"></label>
    <br><br>
    <label>Note Images: <input type="file" id="noteImages" multiple accept="image/*"></label>
    <div class="images-preview" id="noteImagesPreview"></div>
    <br>
    <button onclick="addTopic()">+ Add Topic</button>
  </div>
  <div id="topics"></div>

  <button onclick="previewJSON()">üëÅ Preview JSON</button>
  <button onclick="downloadJSON()">‚¨á Download JSON</button>

  <!-- Modal -->
  <div class="modal" id="jsonModal">
    <div class="modal-content">
      <span class="close" onclick="closeModal()">&times;</span>
      <h3>Generated JSON</h3>
      <div id="jsonOutput" class="json-output"></div>
    </div>
  </div>

  <script>
    let note = { heading: "", images: [], topics: [] };

    function previewImages(input, previewContainer, targetArray) {
      previewContainer.innerHTML = "";
      Array.from(input.files).forEach(file => {
        const reader = new FileReader();
        reader.onload = e => {
          const img = document.createElement("img");
          img.src = e.target.result;
          previewContainer.appendChild(img);
          targetArray.push(e.target.result);
        };
        reader.readAsDataURL(file);
      });
    }

    document.getElementById("noteImages").addEventListener("change", function() {
      note.images = [];
      previewImages(this, document.getElementById("noteImagesPreview"), note.images);
    });

    function addTopic() {
      const index = note.topics.length;
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h2>Topic ${index + 1}</h2>
        <label>Name: <input type="text" onchange="note.topics[${index}].name=this.value"></label><br><br>
        <label>Images: <input type="file" multiple accept="image/*" onchange="handleImages(event, 'topic', ${index})"></label>
        <div class="images-preview" id="topicImagesPreview${index}"></div>
        <br>
        <button onclick="addSubtopic(${index})">+ Add Subtopic</button>
      `;
      document.getElementById("topics").appendChild(div);
      note.topics.push({ name: "", images: [], subtopics: [] });
    }

    function addSubtopic(topicIndex) {
      const index = note.topics[topicIndex].subtopics.length;
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h3>Subtopic ${index + 1}</h3>
        <label>Name: <input type="text" onchange="note.topics[${topicIndex}].subtopics[${index}].name=this.value"></label><br><br>
        <label>Images: <input type="file" multiple accept="image/*" onchange="handleImages(event, 'subtopic', ${topicIndex}, ${index})"></label>
        <div class="images-preview" id="subtopicImagesPreview${topicIndex}_${index}"></div>
        <br>
        <button onclick="addPoint(${topicIndex}, ${index})">+ Add Point</button>
      `;
      document.getElementById("topics").children[topicIndex].appendChild(div);
      note.topics[topicIndex].subtopics.push({ name: "", images: [], points: [] });
    }

    function addPoint(topicIndex, subIndex) {
      const index = note.topics[topicIndex].subtopics[subIndex].points.length;
      const div = document.createElement("div");
      div.className = "card";
      div.innerHTML = `
        <h4>Point ${index + 1}</h4>
        <label>Text: <input type="text" onchange="note.topics[${topicIndex}].subtopics[${subIndex}].points[${index}].text=this.value"></label><br><br>
        <label>Explanation: <input type="text" onchange="note.topics[${topicIndex}].subtopics[${subIndex}].points[${index}].explanation=this.value"></label><br><br>
        <label>Images: <input type="file" multiple accept="image/*" onchange="handleImages(event, 'point', ${topicIndex}, ${subIndex}, ${index})"></label>
        <div class="images-preview" id="pointImagesPreview${topicIndex}_${subIndex}_${index}"></div>
      `;
      document.getElementById("topics").children[topicIndex].appendChild(div);
      note.topics[topicIndex].subtopics[subIndex].points.push({ text: "", explanation: "", images: [] });
    }

    function handleImages(event, level, topicIndex, subIndex, pointIndex) {
      let targetArray;
      let previewId;
      if (level === "topic") {
        targetArray = note.topics[topicIndex].images = [];
        previewId = `topicImagesPreview${topicIndex}`;
      } else if (level === "subtopic") {
        targetArray = note.topics[topicIndex].subtopics[subIndex].images = [];
        previewId = `subtopicImagesPreview${topicIndex}_${subIndex}`;
      } else if (level === "point") {
        targetArray = note.topics[topicIndex].subtopics[subIndex].points[pointIndex].images = [];
        previewId = `pointImagesPreview${topicIndex}_${subIndex}_${pointIndex}`;
      }
      previewImages(event.target, document.getElementById(previewId), targetArray);
    }

    function previewJSON() {
      note.heading = document.getElementById("heading").value;
      document.getElementById("jsonOutput").textContent = JSON.stringify(note, null, 2);
      document.getElementById("jsonModal").style.display = "flex";
    }

    function closeModal() {
      document.getElementById("jsonModal").style.display = "none";
    }

    function downloadJSON() {
      const blob = new Blob([JSON.stringify(note, null, 2)], { type: "application/json" });
      const url = URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "note.json";
      a.click();
      URL.revokeObjectURL(url);
    }
  </script>
</body>
</html>
